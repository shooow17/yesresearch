<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨èƒ½è¾¦å…¬å®¤å·¥å…·ç®± v1</title>
    
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7/download.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
    <script src="https://unpkg.com/heic2any@0.0.4/dist/heic2any.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        /* --- v1ç§‘æŠ€æ„Ÿæ ¸å¿ƒæ¨£å¼è¨­å®š --- */
        :root {
            /* èƒŒæ™¯è‰²ç³» - æ·±ç©ºç§‘æŠ€ */
            --bg-app: #0f172a;        /* æœ€åº•å±¤æ·±è—é»‘ */
            --bg-sidebar: #1a2235;    /* å´é‚Šæ¬„æ·±è‰² */
            --bg-card: rgba(30, 41, 59, 0.85); /* å¡ç‰‡åŠé€æ˜èƒŒæ™¯ (ç£¨ç ‚æ„Ÿ) */
            --bg-input: #26334aff;    /* è¼¸å…¥æ¡†èƒŒæ™¯ */
            
            /* æ–‡å­—é¡è‰² */
            --text-primary: #f1f5f9;  /* ä¸»è¦äº®ç™½å­— */
            --text-secondary: #94a3b8;/* æ¬¡è¦ç°è—å­— */
            --text-muted: #64748b;    /* å¾®å¼±æç¤ºå­— */
            
            /* éœ“è™¹å¼·èª¿è‰² */
            --neon-blue: #00d2ff;     /* é›»å…‰è— (ä¸»è‰²) */
            --neon-purple: #a855f7;   /* éœ“è™¹ç´« (HEIC) */
            --neon-green: #2ecc71;    /* è¢å…‰ç¶  (æˆåŠŸ/æŒ‰éˆ•) */
            --neon-orange: #f97316;   /* äº®æ©˜è‰² (å·¥å…·) */
            --neon-red: #ef4444;      /* è­¦ç¤ºç´… */
            
            /* è³ªæ„Ÿç‰¹æ•ˆ */
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
            --tech-shadow: 0 0 20px rgba(0, 210, 255, 0.15); /* è—è‰²å¾®å…‰ */
            --card-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5); /* æ·±é‚ƒé™°å½± */
            
            /* å­—é«”å¤§å° (åŠ å¤§ç‰ˆ) */
            --fs-base: 16px;          /* åŸºç¤å­—é«”åŠ å¤§ */
            --fs-brand: 1.5rem;       /* LOGO */
            --fs-nav-title: 0.85rem;  /* é¸å–®åˆ†é¡æ¨™é¡Œ */
            --fs-nav-item: 1.1rem;    /* é¸å–®é …ç›® */
            --fs-h2: 2rem;            /* å…§å®¹æ¨™é¡Œ */
            --fs-btn: 1.15rem;        /* æŒ‰éˆ•æ–‡å­— */
            --fs-label: 1.05rem;      /* æ¨™ç±¤æ–‡å­— */
        }
        
        * { box-sizing: border-box; }
        body { 
            font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, Microsoft JhengHei, sans-serif;
            background-color: var(--bg-app);
            /* åŠ å…¥ç´°å¾®çš„ç§‘æŠ€ç¶²æ ¼èƒŒæ™¯åœ– (å¯é¸ï¼Œé€™è£¡ç”¨ CSS æ¨¡æ“¬) */
            background-image: 
                linear-gradient(rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.95)),
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2300d2ff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            color: var(--text-primary);
            margin: 0; 
            padding: 0; 
            display: flex; 
            height: 100vh; 
            overflow: hidden;
            font-size: var(--fs-base); /* è¨­å®šå…¨åŸŸåŸºç¤å­—é«” */
            letter-spacing: 0.5px; /* å¢åŠ ä¸€é»å­—è·ï¼Œæ›´ä¿è½ */
        }

        /* --- å´é‚Šå°è¦½åˆ— (Sidebar) --- */
        .sidebar {
            width: 280px; /* ç¨å¾®åŠ å¯¬ */
            background-color: var(--bg-sidebar);
            border-right: var(--glass-border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            box-shadow: var(--tech-shadow);
            z-index: 10;
        }

        .brand {
            padding: 30px 25px;
            font-size: var(--fs-brand);
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            background: linear-gradient(to right, var(--bg-sidebar), rgba(0,0,0,0.2));
            color: var(--text-primary);
            text-shadow: 0 0 10px rgba(0, 210, 255, 0.5); /* æ¨™é¡Œç™¼å…‰ */
            border-bottom: var(--glass-border);
        }
        .brand span { color: var(--neon-blue); }

        .sidebar-content {
            padding: 20px 0;
            overflow-y: auto;
        }

        .nav-group-title {
            padding: 15px 25px 10px;
            font-size: var(--fs-nav-title);
            text-transform: uppercase;
            letter-spacing: 1.2px;
            color: var(--text-muted);
            font-weight: 700;
        }

        .nav-item {
            padding: 14px 25px; /* åŠ å¤§é»æ“Šå€åŸŸ */
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-size: var(--fs-nav-item);
            color: var(--text-secondary);
            border-left: 4px solid transparent;
            margin-bottom: 2px;
        }

        .nav-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--neon-blue);
            padding-left: 30px; /* Hover æ™‚è¼•å¾®ä½ç§» */
        }

        .nav-item.active {
            background: linear-gradient(to right, rgba(0, 210, 255, 0.15), transparent);
            color: var(--neon-blue);
            border-left: 4px solid var(--neon-blue);
            text-shadow: 0 0 8px rgba(0, 210, 255, 0.6); /* æ¿€æ´»é …ç›®ç™¼å…‰ */
        }
        
        /* é‡å°ä¸åŒé¡å‹çš„æ¿€æ´»è‰² */
        .nav-item.heic-type.active { border-left-color: var(--neon-purple); color: var(--neon-purple); text-shadow: 0 0 8px rgba(168, 85, 247, 0.6); background: linear-gradient(to right, rgba(168, 85, 247, 0.15), transparent); }
        .nav-item.tool-type.active { border-left-color: var(--neon-orange); color: var(--neon-orange); text-shadow: 0 0 8px rgba(249, 115, 22, 0.6); background: linear-gradient(to right, rgba(249, 115, 22, 0.15), transparent); }

        .nav-icon { margin-right: 12px; font-size: 1.2rem; filter: drop-shadow(0 0 2px currentColor); }

        /* --- ä¸»å…§å®¹å€ (Main Content) --- */
        .main-wrapper {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            position: relative;
            /* ä¸»å€åŸŸèƒŒæ™¯å…‰æšˆ */
            background: radial-gradient(circle at top right, rgba(0, 210, 255, 0.1), transparent 40%),
                        radial-gradient(circle at bottom left, rgba(168, 85, 247, 0.1), transparent 40%);
        }

        .content-card {
            background: var(--bg-card);
            backdrop-filter: blur(16px); /* ç£¨ç ‚ç»ç’ƒç‰¹æ•ˆ */
            -webkit-backdrop-filter: blur(16px);
            border: var(--glass-border);
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            padding: 40px; /* åŠ å¤§å…§è· */
            max-width: 950px;
            margin: 0 auto 30px;
            display: none;
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); /* æ›´ä¿è½çš„å‹•ç•« */
        }
        .content-card.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }

        h2 { 
            margin-top: 0; 
            color: var(--text-primary);
            font-size: var(--fs-h2);
            font-weight: 700;
            border-bottom: 1px solid rgba(0, 210, 255, 0.3);
            padding-bottom: 20px; 
            margin-bottom: 30px;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(0, 210, 255, 0.3);
        }
        
        /* --- UI å…ƒä»¶å„ªåŒ– --- */
        label { font-weight: 600; display: block; margin: 20px 0 10px; color: var(--text-secondary); font-size: var(--fs-label); }

        /* è¼¸å…¥æ¡†èˆ‡é¸å–® */
        input[type="file"], select, input[type="text"], input[type="number"], textarea { 
            width: 100%; 
            padding: 15px; /* åŠ å¤§ */
            border: 1px solid rgba(255, 255, 255, 0.15);
            background: var(--bg-input);
            border-radius: 8px; 
            color: var(--text-primary);
            font-size: 1.05rem;
            transition: all 0.3s;
            outline: none;
        }
        input[type="file"] { cursor: pointer; padding: 12px; }
        input::placeholder, textarea::placeholder { color: var(--text-muted); }
        /* Focus ç™¼å…‰æ•ˆæœ */
        input:focus, select:focus, textarea:focus {
            border-color: var(--neon-blue);
            box-shadow: 0 0 0 3px rgba(0, 210, 255, 0.2), inset 0 0 10px rgba(0, 210, 255, 0.1);
        }

        /* æŒ‰éˆ• (ç§‘æŠ€æ„Ÿæ¼¸å±¤èˆ‡ç™¼å…‰) */
        .btn { 
            border: none; padding: 16px 32px; border-radius: 8px; cursor: pointer; font-size: var(--fs-btn); font-weight: 700; width: 100%; margin-top: 30px; transition: all 0.3s ease;
            color: #fff;
            background-size: 200% auto;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 210, 255, 0.4); background-position: right center; }
        .btn:active { transform: translateY(0); }
        .btn:disabled { background: #4b5563; color: #9ca3af; cursor: not-allowed; box-shadow: none; }
        
        /* ä¸åŒåŠŸèƒ½çš„æŒ‰éˆ•é…è‰² (æ¼¸å±¤éœ“è™¹) */
        .btn-blue { background-image: linear-gradient(45deg, #00d2ff 0%, #3a7bd5 51%, #00d2ff 100%); }
        .btn-purple { background-image: linear-gradient(45deg, #a855f7 0%, #7b1fa2 51%, #a855f7 100%); box-shadow: 0 4px 15px rgba(168, 85, 247, 0.3); }
        .btn-purple:hover { box-shadow: 0 8px 25px rgba(168, 85, 247, 0.5); }
        .btn-orange { background-image: linear-gradient(45deg, #f97316 0%, #ea580c 51%, #f97316 100%); box-shadow: 0 4px 15px rgba(249, 115, 22, 0.3); }
        .btn-orange:hover { box-shadow: 0 8px 25px rgba(249, 115, 22, 0.5); }
        .btn-red { background-image: linear-gradient(45deg, #ef4444 0%, #b91c1c 51%, #ef4444 100%); box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3); }

        /* æç¤ºè¨Šæ¯æ¡† */
        .note { 
            background: rgba(0, 210, 255, 0.1);
            color: var(--neon-blue);
            padding: 20px; border-radius: 8px; font-size: 1rem; margin-bottom: 25px; 
            border-left: 4px solid var(--neon-blue); line-height: 1.6;
            backdrop-filter: blur(5px);
        }
        .note.note-purple { background: rgba(168, 85, 247, 0.1); color: #d8b4fe; border-left-color: var(--neon-purple); }
        .note.note-orange { background: rgba(249, 115, 22, 0.1); color: #fdba74; border-left-color: var(--neon-orange); }

        /* ç‹€æ…‹èˆ‡é€²åº¦æ¢ */
        .status { margin-top: 20px; text-align: center; font-weight: bold; color: var(--neon-blue); min-height: 28px; white-space: pre-line; font-size: 1.1rem; text-shadow: 0 0 10px rgba(0,210,255,0.5); }
        .progress-box { width: 100%; background-color: rgba(255,255,255,0.1); border-radius: 20px; margin-top: 25px; display: none; height: 30px; position: relative; overflow: hidden; border: var(--glass-border); }
        .progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, var(--neon-blue), var(--neon-green)); border-radius: 20px; transition: width 0.3s; box-shadow: 0 0 15px var(--neon-blue); }
        .progress-text { position: absolute; width: 100%; text-align: center; top: 4px; font-size: 14px; color: #fff; font-weight: bold; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }

        /* å…¶ä»–å…ƒä»¶å„ªåŒ– */
        .options-grid { display: flex; gap: 25px; margin-bottom: 20px; }
        .thumbnail-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 20px; margin-top: 25px; padding: 20px; background: rgba(0,0,0,0.2); border: 2px dashed rgba(255,255,255,0.2); border-radius: 12px; min-height: 250px; }
        .page-card { background: var(--bg-card); border: var(--glass-border); border-radius: 10px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: all 0.3s; }
        .page-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0, 210, 255, 0.2); border-color: var(--neon-blue); }
        .page-info { background: rgba(0,0,0,0.3); color: var(--text-secondary); padding: 8px 0; font-size: 0.9rem; border-top: var(--glass-border); }
        #extract-container .page-card.selected { border: 2px solid var(--neon-green); box-shadow: 0 0 15px var(--neon-green); }
        .delete-btn { background: var(--neon-red); box-shadow: 0 0 10px var(--neon-red); }

        /* ä¾¿åˆ©è²¼ */
        #memo-area { background-color: rgba(255, 255, 224, 0.9); color: #333; border: none; box-shadow: inset 0 2px 10px rgba(0,0,0,0.1); font-family: 'Consolas', monospace; font-size: 1.1rem;}
        .saved-badge { background: var(--neon-green); box-shadow: 0 0 10px var(--neon-green); padding: 4px 10px; }

        /* é è¦½å€ */
        #previewCanvas, #compress-preview { border: var(--glass-border); box-shadow: var(--card-shadow); border-radius: 8px; }
        #qrcode-display { background: white; border-radius: 8px; padding: 30px; }
        .range-val { color: var(--neon-orange); font-size: 1.1rem; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand">Cyber<span>Tools</span></div>
        <div class="sidebar-content">
            <div class="nav-group-title">PDF æ“ä½œ</div>
            <div class="nav-item active" onclick="switchTab('flatten', this)"><span class="nav-icon">ğŸ–¼ï¸</span>è½‰åœ–ç‰‡ PDF</div>
            <div class="nav-item" onclick="switchTab('ocrWord', this)"><span class="nav-icon">ğŸ“</span>OCR è½‰ Word</div>
            <div class="nav-item" onclick="switchTab('number', this)"><span class="nav-icon">ğŸ”¢</span>åŠ å…¥é ç¢¼</div>
            <div class="nav-item" onclick="switchTab('extract', this)"><span class="nav-icon">ğŸ“„</span>æå–é é¢</div>
            <div class="nav-item" onclick="switchTab('edit', this)"><span class="nav-icon">ğŸ—ï¸</span>é‡çµ„åˆªé™¤</div>
            <div class="nav-item" onclick="switchTab('merge', this)"><span class="nav-icon">ğŸ“‘</span>åˆä½µ PDF</div>

            <div class="nav-group-title" style="margin-top: 20px;">åœ–ç‰‡è™•ç†</div>
            <div class="nav-item heic-type" onclick="switchTab('heicConvert', this)"><span class="nav-icon">ğŸ</span>HEIC è½‰ JPG</div>
            <div class="nav-item heic-type" onclick="switchTab('imgCompress', this)"><span class="nav-icon">ğŸ“‰</span>åœ–ç‰‡ç˜¦èº«</div>

            <div class="nav-group-title" style="margin-top: 20px;">è¾¦å…¬æ·å¾‘</div>
            <div class="nav-item tool-type" onclick="switchTab('quickNote', this)"><span class="nav-icon">ğŸ“’</span>æ™ºæ…§ä¾¿åˆ©è²¼</div>
            <div class="nav-item tool-type" onclick="switchTab('qrGen', this)"><span class="nav-icon">ğŸ“±</span>QR Code</div>
        </div>
    </div>

    <div class="main-wrapper">

        <div id="flatten" class="content-card active">
            <h2>è½‰ç‚ºåœ–ç‰‡å‹ PDF (Flatten)</h2>
            <div class="note">
                ğŸ’¡ <b>åŠŸèƒ½èªªæ˜ï¼š</b>å°‡ PDF æ¯ä¸€é å‘é‡å…§å®¹è½‰ç‚ºé«˜è§£æåº¦åœ–ç‰‡ï¼Œå†é‡æ–°å°è£ã€‚<br>
                ğŸ›¡ï¸ <b>ç”¨é€”ï¼š</b>é˜²æ­¢å…§å®¹è¢«è¤‡è£½ã€ç¢ºä¿æ’ç‰ˆåœ¨ä»»ä½•è£ç½®ä¸€è‡´ã€å»é™¤ç·¨è¼¯å±¬æ€§ã€‚
            </div>
            <label>é¸æ“‡ PDF æª”æ¡ˆï¼š</label>
            <input type="file" id="flattenFile" accept="application/pdf">
            <label>è½‰æ›å“è³ª (è§£æåº¦)ï¼š</label>
            <select id="flattenQuality">
                <option value="1.5">ä¸€èˆ¬å“è³ª (é©åˆè¢å¹•ç€è¦½)</option>
                <option value="2.0" selected>é«˜å“è³ª (æ¨è–¦ï¼Œå¹³è¡¡é»)</option>
                <option value="3.0">è¶…é«˜å“è³ª (é©åˆåˆ—å°ï¼Œæª”æ¡ˆè¼ƒå¤§)</option>
            </select>
            <button id="btnFlatten" class="btn btn-blue" onclick="flattenPDF()">ğŸš€ é–‹å§‹åŸ·è¡Œè½‰æ›</button>
            <div id="flattenProgressBox" class="progress-box"><div id="flattenProgressBar" class="progress-bar"></div></div>
            <div id="flattenStatus" class="status"></div>
        </div>

        <div id="ocrWord" class="content-card">
            <h2>OCR æ™ºèƒ½åœ–æ–‡è¾¨è­˜è½‰ Word</h2>
            <div class="note">
                ğŸ’¡ <b>æŠ€è¡“åŸç†ï¼š</b>å…ˆå°‡ PDF é é¢æˆªåœ–ä»¥ä¿ç•™ 100% åŸå§‹æ’ç‰ˆï¼Œå†é€é AI æ¨¡å‹è¾¨è­˜åœ–ç‰‡ä¸­çš„æ–‡å­—ã€‚<br>
                âš¡ <b>æ•ˆèƒ½æé†’ï¼š</b>æ­¤éç¨‹é‹ç®—é‡å¤§ï¼Œé€Ÿåº¦è¼ƒæ…¢ï¼Œè«‹è€å¿ƒç­‰å¾…ã€‚
            </div>
            <label>é¸æ“‡ PDF æª”æ¡ˆï¼š</label>
            <input type="file" id="ocrFile" accept="application/pdf">
            <div class="options-grid">
                <div style="flex:1">
                    <label>æ–‡ä»¶èªè¨€ï¼š</label>
                    <select id="ocrLang">
                        <option value="chi_tra">ç¹é«”ä¸­æ–‡ (Traditional Chinese)</option>
                        <option value="eng">è‹±æ–‡ (English)</option>
                        <option value="chi_tra+eng">ä¸­è‹±æ··åˆ</option>
                    </select>
                </div>
                <div style="flex:1">
                    <label>è¼¸å‡ºæ¨¡å¼ï¼š</label>
                    <select id="ocrMode">
                        <option value="image_text">åœ–ç‰‡ä¿ç•™æ’ç‰ˆ + ç´”æ–‡å­— (æ¨è–¦)</option>
                    </select>
                </div>
            </div>
            <button id="btnOcr" class="btn btn-blue" onclick="startOcrConversion()">ğŸ§  å•Ÿå‹•æ™ºèƒ½è¾¨è­˜</button>
            <div id="ocrProgressBox" class="progress-box"><div id="ocrProgressBar" class="progress-bar"></div><div id="ocrProgressText" class="progress-text"></div></div>
            <div id="ocrStatus" class="status"></div>
        </div>

        <div id="number" class="content-card">
            <h2>PDF åŠ å…¥é ç¢¼ (å³æ™‚é è¦½)</h2>
            <div class="note">ğŸ’¡ é¸æ“‡æª”æ¡ˆå¾Œï¼Œèª¿æ•´ä¸‹æ–¹åƒæ•¸ï¼Œé è¦½å€æœƒå³æ™‚é¡¯ç¤ºç¬¬ä¸€é çš„æ•ˆæœã€‚</div>
            <label>é¸æ“‡ PDF æª”æ¡ˆï¼š</label>
            <input type="file" id="numberFile" accept="application/pdf" onchange="initPageNumberPreview()">
            <div class="options-grid">
                <div style="flex:1"><label>ä½ç½®ï¼š</label><select id="numPosition" onchange="updatePreviewDrawing()"><option value="center">é å°¾ç½®ä¸­</option><option value="right">é å°¾é å³</option><option value="left">é å°¾é å·¦</option></select></div>
                <div style="flex:1"><label>æ¨£å¼ï¼š</label><select id="numStyle" onchange="updatePreviewDrawing()"><option value="simple">ç´”æ•¸å­— (1)</option><option value="standard">æ¨™æº– (Page 1)</option><option value="total">ç¸½é æ•¸ (1 / 10)</option></select></div>
            </div>
            <label>é è¦½çµæœï¼š</label>
            <div style="background:rgba(0,0,0,0.2); padding:20px; text-align:center; border-radius:12px; border: var(--glass-border);">
                <canvas id="previewCanvas" style="display:none; max-width:100%;"></canvas>
            </div>
            <button class="btn btn-blue" onclick="addPageNumbers()">ğŸ–¨ï¸ åŠ å…¥é ç¢¼ä¸¦ä¸‹è¼‰</button>
        </div>

        <div id="extract" class="content-card">
            <h2>æå– PDF é é¢</h2>
            <div class="note">ğŸ’¡ è¼‰å…¥æª”æ¡ˆå¾Œï¼Œé»æ“Šç¸®åœ–é¸æ“‡ä½ æƒ³è¦çš„é é¢ï¼ˆé¸ä¸­æœƒç™¼å…‰ï¼‰ï¼Œæœ€å¾Œå¦å­˜æ–°æª”ã€‚</div>
            <input type="file" id="extractFile" accept="application/pdf" onchange="loadExtractThumbnails()">
            <div id="extract-container" class="thumbnail-grid"></div>
            <button class="btn btn-blue" onclick="saveExtractedPages()">ğŸ’¾ ä¸‹è¼‰é¸å–çš„é é¢</button>
        </div>

        <div id="edit" class="content-card">
            <h2>é‡çµ„èˆ‡åˆªé™¤é é¢</h2>
            <div class="note">ğŸ’¡ ç”¨æ»‘é¼ æ‹–æ›³å¡ç‰‡å¯æ”¹è®Šé é¢é †åºï¼Œé»æ“Šå¡ç‰‡å³ä¸Šè§’çš„ç´…è‰² X å¯åˆªé™¤è©²é ã€‚</div>
            <input type="file" id="editFile" accept="application/pdf" onchange="loadEditThumbnails()">
            <div id="edit-container" class="thumbnail-grid"></div>
            <button class="btn btn-blue" onclick="saveEditedPDF()">ğŸ”„ å„²å­˜é‡çµ„çµæœ</button>
        </div>

        <div id="merge" class="content-card">
            <h2>åˆä½µå¤šå€‹ PDF</h2>
            <div class="note">ğŸ’¡ æŒ‰ä½ Ctrl æˆ– Shift éµé¸æ“‡å¤šå€‹ PDF æª”æ¡ˆï¼Œå°‡å®ƒå€‘ä¾åºä¸²æ¥æˆä¸€ä»½æ–‡ä»¶ã€‚</div>
            <label>é¸æ“‡å¤šå€‹æª”æ¡ˆï¼š</label>
            <input type="file" id="mergeFiles" multiple accept="application/pdf">
            <button class="btn btn-blue" onclick="mergePDFs()">ğŸ”— åˆä½µä¸¦ä¸‹è¼‰</button>
            <div id="mergeStatus" class="status"></div>
        </div>

        <div id="heicConvert" class="content-card">
            <h2>HEIC è½‰ JPG (iPhone ç…§ç‰‡æ•‘æ˜Ÿ)</h2>
            <div class="note note-purple">ğŸ’¡ æ”¯æ´æ‰¹æ¬¡è½‰æ›ã€‚å°‡è˜‹æœè£ç½®çš„ HEIC é«˜æ•ˆåœ–æª”è½‰ç‚ºé€šç”¨çš„ JPG æ ¼å¼ã€‚</div>
            <label>é¸æ“‡ HEIC æª”æ¡ˆ (å¯å¤šé¸)ï¼š</label>
            <input type="file" id="heicFiles" multiple accept=".heic,.HEIC">
            <button id="btnHeic" class="btn btn-purple" onclick="processHeicConversion()">ğŸ”„ é–‹å§‹æ‰¹æ¬¡è½‰æ›</button>
            <div id="heicProgressBox" class="progress-box"><div id="heicProgressBar" class="progress-bar" style="background: var(--neon-purple); box-shadow: 0 0 15px var(--neon-purple);"></div><div id="heicProgressText" class="progress-text"></div></div>
            <div id="heicStatus" class="status" style="color:var(--neon-purple); text-shadow: 0 0 10px var(--neon-purple);"></div>
        </div>

        <div id="imgCompress" class="content-card">
            <h2>åœ–ç‰‡ç˜¦èº«ç«™ (æ¥µé€Ÿå£“ç¸®)</h2>
            <div class="note note-purple">ğŸ’¡ èª¿æ•´æœ€å¤§å¯¬åº¦èˆ‡å£“ç¸®å“è³ªï¼Œåœ¨è‚‰çœ¼å¹¾ä¹ç„¡æ³•åˆ†è¾¨çš„æƒ…æ³ä¸‹å¤§å¹…æ¸›å°‘æª”æ¡ˆå¤§å°ã€‚</div>
            <label>é¸æ“‡åœ–ç‰‡ (JPG/PNG)ï¼š</label>
            <input type="file" id="compImgFile" accept="image/jpeg, image/png">
            <div class="options-grid">
                <div style="flex:1"><div class="range-wrap"><label>æœ€å¤§å¯¬åº¦é™åˆ¶ï¼š<span id="widthVal" class="range-val">1920px</span></label><input type="range" id="compWidth" min="400" max="3840" value="1920" step="10" oninput="document.getElementById('widthVal').innerText = this.value + 'px'"></div></div>
                <div style="flex:1"><div class="range-wrap"><label>å£“ç¸®å“è³ª (Quality)ï¼š<span id="qualVal" class="range-val">0.7 (70%)</span></label><input type="range" id="compQuality" min="0.1" max="1.0" value="0.7" step="0.1" oninput="document.getElementById('qualVal').innerText = this.value + ' (' + Math.round(this.value*100) + '%)'"></div></div>
            </div>
            <button class="btn btn-purple" onclick="processImgCompress()">âš¡ åŸ·è¡Œå£“ç¸®ä¸¦é è¦½</button>
            <div style="text-align:center; margin-top:30px;">
                <div id="compResultInfo" style="font-weight:bold; color:var(--neon-orange); margin-bottom:15px; font-size: 1.1rem;"></div>
                <img id="compress-preview">
                <button id="btnDownloadComp" class="btn btn-purple" style="display:none; width: auto; margin-top: 20px;" onclick="downloadCompressedImg()">ğŸ’¾ ä¸‹è¼‰ç˜¦èº«åœ–ç‰‡</button>
            </div>
        </div>

        <div id="quickNote" class="content-card">
            <h2>æ™ºæ…§ä¾¿åˆ©è²¼</h2>
            <div class="note note-orange">
                ğŸ’¡ å…§å®¹æœƒ<b>è‡ªå‹•å„²å­˜åœ¨ç€è¦½å™¨çš„æš«å­˜ç©ºé–“</b>ï¼Œå³ä½¿é—œé–‰ç¶²é æˆ–é‡æ–°æ•´ç†ï¼Œä¸‹æ¬¡æ‰“é–‹å…§å®¹ä¾ç„¶å­˜åœ¨ã€‚
            </div>
            <div class="memo-toolbar">
                <button class="btn" style="margin:0; padding: 10px 20px; background:var(--neon-orange); color:#fff; width:auto; box-shadow: 0 4px 15px rgba(249, 115, 22, 0.3);" onclick="copyMemo()">ğŸ“‹ è¤‡è£½å…¨æ–‡</button>
                <button class="btn" style="margin:0; padding: 10px 20px; background:var(--neon-blue); color:white; width:auto;" onclick="downloadMemo()">ğŸ’¾ ä¸‹è¼‰ .txt</button>
                <button class="btn" style="margin:0; padding: 10px 20px; background:var(--neon-red); color:white; width:auto; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);" onclick="clearMemo()">ğŸ—‘ï¸ æ¸…ç©º</button>
                <span id="saveBadge" class="saved-badge">å·²è‡ªå‹•å„²å­˜</span>
                <div class="char-count">ç›®å‰å­—æ•¸: <span id="charCount" style="color:var(--neon-orange); font-weight:bold;">0</span></div>
            </div>
            <textarea id="memo-area" placeholder="åœ¨é€™è£¡è¼¸å…¥ä½ çš„æƒ³æ³•ã€è‰ç¨¿æˆ–å¾…è¾¦äº‹é …..." oninput="onMemoInput()"></textarea>
        </div>

        <div id="qrGen" class="content-card">
            <h2>QR Code å¿«é€Ÿç”¢ç”Ÿå™¨</h2>
            <div class="note note-orange">ğŸ’¡ è¼¸å…¥ç¶²å€æˆ–æ–‡å­—ï¼Œå³æ™‚ç”Ÿæˆ QR Code åœ–ç‰‡ã€‚æœ¬åœ°é‹ç®—ï¼Œå®‰å…¨éš±ç§ã€‚</div>
            <label>è¼¸å…¥ç¶²å€æˆ–æ–‡å­—å…§å®¹ï¼š</label>
            <input type="text" id="qrText" placeholder="https://example.com" onkeyup="if(event.key === 'Enter') generateQR()">
            <button class="btn btn-orange" onclick="generateQR()">ğŸ“± ç”¢ç”Ÿ QR Code</button>
            <div id="qrcode-display"></div>
            <div style="text-align:center;"><button id="btnDownloadQR" class="btn btn-orange" style="display:none; width:auto; margin-top:20px;" onclick="downloadQR()">ğŸ’¾ ä¸‹è¼‰ QR åœ–ç‰‡</button></div>
        </div>

    </div>

<script>
    /* --- Javascript é‚è¼¯ (åŠŸèƒ½ä¿æŒä¸è®Šï¼Œåƒ…é…åˆæ–° UI åšå¾®èª¿) --- */
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
    const { PDFDocument, StandardFonts, rgb } = PDFLib;

    // åˆ‡æ›åˆ†é é‚è¼¯
    function switchTab(cardId, navItem) {
        document.querySelectorAll('.content-card').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        document.getElementById(cardId).classList.add('active');
        navItem.classList.add('active');
    }

    // ==========================================
    // ä¾¿åˆ©è²¼é‚è¼¯
    // ==========================================
    window.addEventListener('load', function() {
        const saved = localStorage.getItem('office_toolbox_note_v12');
        if(saved) {
            document.getElementById('memo-area').value = saved;
            document.getElementById('charCount').innerText = saved.length;
        }
    });
    function onMemoInput() {
        const text = document.getElementById('memo-area').value;
        localStorage.setItem('office_toolbox_note_v12', text); // ä½¿ç”¨æ–°çš„ key é¿å…è¡çª
        document.getElementById('charCount').innerText = text.length;
        const badge = document.getElementById('saveBadge');
        badge.style.display = 'inline-block';
        setTimeout(() => { badge.style.display = 'none'; }, 1000);
    }
    function copyMemo() {
        document.getElementById('memo-area').select();
        document.execCommand('copy');
        alert("âœ… æ–‡å­—å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
    }
    function downloadMemo() {
        const text = document.getElementById('memo-area').value;
        if(!text) return alert("æ²’æœ‰å…§å®¹å¯ä»¥ä¸‹è¼‰");
        download(new Blob([text], {type:"text/plain"}), "æˆ‘çš„ç­†è¨˜.txt", "text/plain");
    }
    function clearMemo() {
        if(confirm("âš ï¸ ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰å…§å®¹å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚")) {
            document.getElementById('memo-area').value = "";
            localStorage.removeItem('office_toolbox_note_v12');
            document.getElementById('charCount').innerText = "0";
        }
    }

    // ==========================================
    // åœ–ç‰‡ç˜¦èº« & QR Code
    // ==========================================
    let compressedBlob = null;
    function processImgCompress() {
        const file = document.getElementById('compImgFile').files[0];
        const maxWidth = parseInt(document.getElementById('compWidth').value);
        const quality = parseFloat(document.getElementById('compQuality').value);
        const imgPreview = document.getElementById('compress-preview');
        const infoDiv = document.getElementById('compResultInfo');
        const downBtn = document.getElementById('btnDownloadComp');
        if(!file) return alert("è«‹å…ˆé¸æ“‡åœ–ç‰‡ï¼");
        infoDiv.innerText = "æ­£åœ¨è™•ç†ä¸­...";
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = new Image();
            img.onload = function() {
                const canvas = document.createElement('canvas');
                let w = img.width, h = img.height;
                if (w > maxWidth) { h = Math.round(h * (maxWidth / w)); w = maxWidth; }
                canvas.width = w; canvas.height = h;
                canvas.getContext('2d').drawImage(img, 0, 0, w, h);
                canvas.toBlob(function(blob) {
                    compressedBlob = blob;
                    imgPreview.src = URL.createObjectURL(blob);
                    imgPreview.style.display = 'inline-block';
                    // åŠ ä¸Šå–®ä½æ›ç®—èˆ‡é¡è‰²å¼·èª¿
                    const orgSize = (file.size/1024).toFixed(1);
                    const newSize = (blob.size/1024).toFixed(1);
                    const savings = Math.round((1 - (blob.size/file.size)) * 100);
                    infoDiv.innerHTML = `ğŸ“¦ åŸå§‹å¤§å°: ${orgSize} KB <span style="margin:0 10px">â”</span> âœ¨ ç˜¦èº«å¾Œ: <span style="color:var(--neon-green)">${newSize} KB</span> (ç¯€çœäº† ${savings}%)`;
                    downBtn.style.display = 'inline-block';
                }, 'image/jpeg', quality);
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }
    function downloadCompressedImg() { if(compressedBlob) download(compressedBlob, "compressed_image_optimized.jpg", "image/jpeg"); }

    let qrcodeObj = null;
    function generateQR() {
        const text = document.getElementById('qrText').value;
        const container = document.getElementById('qrcode-display');
        const downBtn = document.getElementById('btnDownloadQR');
        if(!text) return alert("è«‹è¼¸å…¥è¦è½‰æ›çš„ç¶²å€æˆ–æ–‡å­—ï¼");
        container.innerHTML = "";
        // èª¿æ•´ QR Code é¡è‰²ä»¥é…åˆæ·±è‰²ä¸»é¡Œ (ä½†ä¿æŒé«˜å°æ¯”ä»¥ä¾¿æƒæ)
        qrcodeObj = new QRCode(container, { text: text, width: 220, height: 220, colorDark : "#000000", colorLight : "#ffffff", correctLevel : QRCode.CorrectLevel.H });
        downBtn.style.display = 'inline-block';
    }
    function downloadQR() { const img = document.querySelector('#qrcode-display img'); if(img) download(img.src, "qrcode.png", "image/png"); }

    // ==========================================
    // PDF / HEIC / OCR é—œéµä»£ç¢¼ (å£“ç¸®ç‰ˆï¼ŒåŠŸèƒ½ä¸è®Š)
    // ==========================================
    async function processHeicConversion(){const fs=document.getElementById('heicFiles').files;const btn=document.getElementById('btnHeic');if(!fs.length)return alert("è«‹é¸æ“‡è‡³å°‘ä¸€å€‹ HEIC æª”æ¡ˆ");btn.disabled=true;document.getElementById('heicProgressBox').style.display='block';let c=0;const pt=document.getElementById('heicProgressText');const pb=document.getElementById('heicProgressBar');for(let i=0;i<fs.length;i++){pt.innerText=`æ­£åœ¨è½‰æ›: ${i+1} / ${fs.length}`;pb.style.width=`${((i)/fs.length)*100}%`;try{const b=await heic2any({blob:fs[i],toType:"image/jpeg",quality:0.8});download(Array.isArray(b)?b[0]:b,fs[i].name.replace(/\..+/,".jpg"),"image/jpeg");c++;await new Promise(r=>setTimeout(r,500));}catch(e){console.error(e);}}pb.style.width='100%';pt.innerText="å…¨éƒ¨å®Œæˆ";document.getElementById('heicStatus').innerText=`âœ… æˆåŠŸè½‰æ› ${c} å€‹æª”æ¡ˆ`;btn.disabled=false;}
    async function startOcrConversion(){const f=document.getElementById('ocrFile').files[0];const l=document.getElementById('ocrLang').value;const btn=document.getElementById('btnOcr');if(!f)return alert("è«‹é¸æ“‡ PDF æª”æ¡ˆ");btn.disabled=true;document.getElementById('ocrProgressBox').style.display='block';const pt=document.getElementById('ocrProgressText');const pb=document.getElementById('ocrProgressBar');const st=document.getElementById('ocrStatus');st.innerText="";try{pt.innerText="æ­£åœ¨åˆå§‹åŒ– OCR å¼•æ“...";pb.style.width="5%";const pdf=await pdfjsLib.getDocument(await f.arrayBuffer()).promise;const w=Tesseract.createWorker();await w.load();await w.loadLanguage(l);await w.initialize(l);let h="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word'><body>";for(let i=1;i<=pdf.numPages;i++){pt.innerText=`æ­£åœ¨è¾¨è­˜ç¬¬ ${i} é  / å…± ${pdf.numPages} é `;pb.style.width=`${((i-1)/pdf.numPages)*100}%`;const p=await pdf.getPage(i);const vp=p.getViewport({scale:2.0});const c=document.createElement('canvas');c.width=vp.width;c.height=vp.height;await p.render({canvasContext:c.getContext('2d'),viewport:vp}).promise;const {data:{text}}=await w.recognize(c);h+=`<p><img src="${c.toDataURL('image/jpeg',0.8)}" width="${vp.width/2}"/></p><div style="margin-top:10px;border-top:1px dashed #ccc;padding-top:5px;color:#555;font-size:10pt;">[OCR æ–‡å­—]<br>${text.replace(/\n/g,'<br>')}</div><br style='page-break-after:always;'/>`;}await w.terminate();h+="</body></html>";pb.style.width="100%";pt.innerText="å®Œæˆï¼æ­£åœ¨ä¸‹è¼‰...";download(new Blob(['\ufeff',h],{type:'application/msword'}),"ocr_converted.doc","application/msword");st.innerText="âœ… è½‰æ›æˆåŠŸï¼";}catch(e){alert("éŒ¯èª¤: "+e.message);st.innerText="âŒ ç™¼ç”ŸéŒ¯èª¤";}finally{btn.disabled=false;}}
    async function flattenPDF(){const f=document.getElementById('flattenFile').files[0];if(!f)return alert('è«‹é¸æ“‡ PDF æª”æ¡ˆ');const q=parseFloat(document.getElementById('flattenQuality').value);const pb=document.getElementById('flattenProgressBar');document.getElementById('flattenProgressBox').style.display='block';const btn=document.getElementById('btnFlatten');btn.disabled=true;const st=document.getElementById('flattenStatus');st.innerText="åˆå§‹åŒ–ä¸­...";try{const s=await pdfjsLib.getDocument(await f.arrayBuffer()).promise;const n=await PDFDocument.create();for(let i=1;i<=s.numPages;i++){st.innerText=`æ­£åœ¨è½‰æ›ç¬¬ ${i} é ...`;pb.style.width=`${(i/s.numPages)*100}%`;const p=await s.getPage(i);const v=p.getViewport({scale:q});const c=document.createElement('canvas');c.width=v.width;c.height=v.height;await p.render({canvasContext:c.getContext('2d'),viewport:v}).promise;const img=await n.embedJpg(c.toDataURL('image/jpeg',0.8));const d=img.scale(1/q);n.addPage([d.width,d.height]).drawImage(img,{x:0,y:0,width:d.width,height:d.height});}st.innerText="âœ… å®Œæˆï¼æ­£åœ¨ä¸‹è¼‰...";download(await n.save(),"flattened_image.pdf","application/pdf");}catch(e){st.innerText="âŒ éŒ¯èª¤: "+e.message;}finally{btn.disabled=false;}}
    let pp,pbi;async function initPageNumberPreview(){const f=document.getElementById('numberFile').files[0];if(!f)return;pp=await pdfjsLib.getDocument(await f.arrayBuffer()).promise;const p=await pp.getPage(1);const v=p.getViewport({scale:0.8});const c=document.getElementById('previewCanvas');c.style.display='block';c.width=v.width;c.height=v.height;const oc=document.createElement('canvas');oc.width=v.width;oc.height=v.height;await p.render({canvasContext:oc.getContext('2d'),viewport:v}).promise;pbi=oc;updatePreviewDrawing();}function updatePreviewDrawing(){if(!pbi)return;const ctx=document.getElementById('previewCanvas').getContext('2d');ctx.drawImage(pbi,0,0);const s=document.getElementById('numStyle').value;const ps=document.getElementById('numPosition').value;const t=s==='simple'?'1':(s==='standard'?'Page 1':`1 / ${pp.numPages}`);ctx.font='bold 14px Helvetica';ctx.fillStyle='#000';const w=ctx.measureText(t).width;let x=20;if(ps==='center')x=(ctx.canvas.width/2)-(w/2);else if(ps==='right')x=ctx.canvas.width-w-40;ctx.fillText(t,x,ctx.canvas.height-20);}async function addPageNumbers(){const f=document.getElementById('numberFile').files[0];if(!f)return;const pdf=await PDFDocument.load(await f.arrayBuffer());const font=await pdf.embedFont(StandardFonts.HelveticaBold);const s=document.getElementById('numStyle').value;const ps=document.getElementById('numPosition').value;pdf.getPages().forEach((p,i)=>{const t=s==='simple'?`${i+1}`:(s==='standard'?`Page ${i+1}`:`${i+1} / ${pdf.getPageCount()}`);const w=font.widthOfTextAtSize(t,12);let x=40;if(ps==='center')x=(p.getSize().width/2)-(w/2);else if(ps==='right')x=p.getSize().width-w-40;p.drawText(t,{x,y:20,size:12,font,color:rgb(0,0,0)});});download(await pdf.save(),"numbered.pdf","application/pdf");}
    async function loadExtractThumbnails(){const f=document.getElementById('extractFile').files[0];if(!f)return;const p=await pdfjsLib.getDocument(await f.arrayBuffer()).promise;const c=document.getElementById('extract-container');c.innerHTML='';for(let i=1;i<=p.numPages;i++){const pg=await p.getPage(i);const v=pg.getViewport({scale:0.2});const d=document.createElement('div');d.className='page-card';d.dataset.p=i-1;d.onclick=function(){this.classList.toggle('selected')};const cv=document.createElement('canvas');cv.width=v.width;cv.height=v.height;await pg.render({canvasContext:cv.getContext('2d'),viewport:v}).promise;d.innerHTML=`<div class="page-info">ç¬¬ ${i} é </div>`;d.prepend(cv);c.append(d);}}async function saveExtractedPages(){const s=document.querySelectorAll('#extract-container .selected');if(!s.length)return alert('è«‹è‡³å°‘é¸æ“‡ä¸€é ');const src=await PDFDocument.load(await document.getElementById('extractFile').files[0].arrayBuffer());const n=await PDFDocument.create();(await n.copyPages(src,Array.from(s).map(e=>parseInt(e.dataset.p)))).forEach(p=>n.addPage(p));download(await n.save(),"extracted_pages.pdf","application/pdf");}
    async function loadEditThumbnails(){const f=document.getElementById('editFile').files[0];if(!f)return;const p=await pdfjsLib.getDocument(await f.arrayBuffer()).promise;const c=document.getElementById('edit-container');c.innerHTML='';for(let i=1;i<=p.numPages;i++){const pg=await p.getPage(i);const v=pg.getViewport({scale:0.2});const d=document.createElement('div');d.className='page-card';d.dataset.o=i-1;const cv=document.createElement('canvas');cv.width=v.width;cv.height=v.height;await pg.render({canvasContext:cv.getContext('2d'),viewport:v}).promise;d.innerHTML=`<button class="delete-btn" onclick="event.stopPropagation();this.parentNode.remove()">Ã—</button><div class="page-info">åŸç¬¬ ${i} é </div>`;d.prepend(cv);c.append(d);}new Sortable(c,{animation:150});}async function saveEditedPDF(){const s=document.querySelectorAll('#edit-container .page-card');if(!s.length)return alert('é é¢åˆ—è¡¨ç‚ºç©º');const src=await PDFDocument.load(await document.getElementById('editFile').files[0].arrayBuffer());const n=await PDFDocument.create();(await n.copyPages(src,Array.from(s).map(e=>parseInt(e.dataset.o)))).forEach(p=>n.addPage(p));download(await n.save(),"sorted_document.pdf","application/pdf");}async function mergePDFs(){const fs=document.getElementById('mergeFiles').files;if(fs.length<2)return alert('è«‹è‡³å°‘é¸æ“‡ 2 å€‹ PDF æª”æ¡ˆ');const d=await PDFDocument.create();for(let f of fs){const s=await PDFDocument.load(await f.arrayBuffer());(await d.copyPages(s,s.getPageIndices())).forEach(p=>d.addPage(p));}download(await d.save(),"merged_document.pdf","application/pdf");document.getElementById('mergeStatus').innerText="âœ… åˆä½µå®Œæˆï¼";}
</script>

</body>
</html>